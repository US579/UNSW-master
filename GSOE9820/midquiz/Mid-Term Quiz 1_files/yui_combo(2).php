YUI.add("moodle-core-session-extend",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)};e.extend(n,e.Base,{initializer:function(){this.gracePeriod=300,this.alertAfter=this.get("timeout")-this.gracePeriod,this.alertAfter<60&&(this.alertAfter=60),this.panel=null,this.sessionTimeout=this.sessionTimeout||{},this.sessionTimeout.idletimer=e.later(this.alertAfter*1e3,this,this.alertuser);var t=new Date;this.lastEditorKeepalive=this.sessionTimeout.lastEdit=t.getTime(),this.sessionTimeout.editortimer=e.later(3e5,this,this.checkEditorActivity)},alertuser:function(){var e=this,t=[{value:M.str.moodle["continue"],action:function(t){e.extendsession(e,t),t.preventDefault()}},{value:M.str.moodle.sessionexpiryignore,action:function(e){e.preventDefault(),this.hide()}}];this.showpanel(M.str.moodle.sessionexpiryalert,M.str.moodle.sessionexpiryalert_desc,t)},checkEditorActivity:function(){this.sessionTimeout.lastEdit>this.lastEditorKeepalive&&e.io(M.cfg.wwwroot+"/local/session_extend.php?sesskey="+M.cfg.sesskey,{context:this,on:{complete:function(t,n){var r=JSON.parse(n.responseText);r.result==="success"?(this.lastEditorKeepalive=this.sessionTimeout.lastEdit,this.sessionTimeout.idletimer.cancel(),this.sessionTimeout.idletimer=e.later(this.alertAfter*1e3,this,this.alertuser)):(this.notify(!1),this.sessionTimeout.idletimer.cancel(),this.sessionTimeout.editortimer.cancel())}}}),this.sessionTimeout.editortimer=e.later(3e5,this,this.checkEditorActivity)},showpanel:function(t,n,r){for(var i=0;i<r.length;i++)r[i].section=e.WidgetStdMod.FOOTER;this.panel=new e.Panel({headerContent:t,bodyContent:n,width:400,zIndex:6,centered:!0,modal:!0,render:"#panel",plugin:[e.Plugin.Drag],buttons:r}),this.panel.show()},extendsession:function(t,n){n.target.remove(),this.panel.set("bodyContent",M.str.moodle.sessionextendattempt),e.io(M.cfg.wwwroot+"/local/session_extend.php?sesskey="+M.cfg.sesskey,{context:this,on:{complete:function(t,n){var r=JSON.parse(n.responseText);this.panel.hide(),r.result==="success"?(this.lastEditorKeepalive=this.sessionTimeout.lastEdit,this.notify(!0),this.sessionTimeout.idletimer=e.later(this.alertAfter*1e3,this,this.alertuser)):this.notify(!1)}}})},notify:function(t){var n=M.str.moodle.sessionexpired,r=M.str.moodle.sessionexpired_desc;t&&(n=M.str.moodle.sessionextended,r=M.str.moodle.sessionextended_desc),this.showpanel(n,r,[{value:M.str.moodle.ok,section:e.WidgetStdMod.FOOTER,action:function(e){e.preventDefault(),this.hide()}}])},sessionTimeoutEditorContentsChanged:function(){this.sessionTimeout.lastEdit=(new Date).getTime()}},{NAME:"moodle-core-session-extend",ATTRS:{timeout:{value:"7200",validator:function(t){return e.Lang.isNumber(t)}}}}),M.core=M.core||{},M.core.sessionextend=M.core.sessionextend||{},M.core.sessionextend.init=function(e){return M.core.sessionextend=new n(e),M.core.sessionextend}},"@VERSION@",{requires:["base","node","io-base","panel","dd-plugin"]});
